{"version":3,"sources":["../src/config/index.ts","../src/core/errors.ts","../src/config/defaults.ts"],"sourcesContent":["import path from \"node:path\";\nimport os from \"node:os\";\nimport fs from \"node:fs\";\nimport type { Tier } from \"../core/types.js\";\nimport { ConfigError } from \"../core/errors.js\";\nimport { DEFAULTS } from \"./defaults.js\";\nimport type { Config, ResolvedConfig, QdrantConfig, AgeConfig, EmbeddingConfig, ExtractionConfig } from \"./schema.js\";\n\nexport type { Config, ResolvedConfig } from \"./schema.js\";\n\n// ── Helper: expand ~ to home dir ────────────────────────────────────────\n\nfunction expandHome(p: string): string {\n  if (p.startsWith(\"~/\") || p === \"~\") {\n    return path.join(os.homedir(), p.slice(1));\n  }\n  return p;\n}\n\n// ── Data Directory ──────────────────────────────────────────────────────\n\nexport function getDataDir(): string {\n  return process.env.OPENCLAW_MEMORY_DATA_DIR || path.join(os.homedir(), \".openclaw-memory\");\n}\n\nexport function getDefaultSqlitePath(): string {\n  return path.join(getDataDir(), \"memory.sqlite\");\n}\n\nexport function getPidFilePath(): string {\n  return path.join(getDataDir(), \"server.pid\");\n}\n\n// ── Config File Discovery ───────────────────────────────────────────────\n\nfunction getConfigSearchPaths(cwd: string): string[] {\n  return [\n    path.join(cwd, \"openclaw-memory.config.ts\"),\n    path.join(cwd, \"openclaw-memory.config.js\"),\n    path.join(cwd, \"openclaw-memory.config.json\"),\n    path.join(getDataDir(), \"config.ts\"),\n    path.join(getDataDir(), \"config.json\"),\n  ];\n}\n\nasync function loadConfigFile(configPath?: string): Promise<Config | null> {\n  const searchPaths = configPath ? [configPath] : getConfigSearchPaths(process.cwd());\n\n  for (const p of searchPaths) {\n    if (fs.existsSync(p)) {\n      if (p.endsWith(\".json\")) {\n        const content = fs.readFileSync(p, \"utf-8\");\n        return JSON.parse(content) as Config;\n      }\n      // For .ts and .js files, try dynamic import\n      try {\n        const mod = await import(p);\n        return (mod.default || mod) as Config;\n      } catch {\n        // Can't import .ts outside of Bun — skip\n      }\n    }\n  }\n\n  return null;\n}\n\n// ── Environment Variable Loading ────────────────────────────────────────\n\nfunction loadFromEnv(): Partial<Config> {\n  const config: Partial<Config> = {};\n\n  // Load .env file if dotenv is available\n  try {\n    const dotenvPath = path.join(process.cwd(), \".env\");\n    if (fs.existsSync(dotenvPath)) {\n      const envContent = fs.readFileSync(dotenvPath, \"utf-8\");\n      for (const line of envContent.split(\"\\n\")) {\n        const trimmed = line.trim();\n        if (!trimmed || trimmed.startsWith(\"#\")) continue;\n        const eqIdx = trimmed.indexOf(\"=\");\n        if (eqIdx === -1) continue;\n        const key = trimmed.slice(0, eqIdx).trim();\n        const value = trimmed.slice(eqIdx + 1).trim().replace(/^[\"']|[\"']$/g, \"\");\n        if (!process.env[key]) {\n          process.env[key] = value;\n        }\n      }\n    }\n  } catch {\n    // No .env file — that's fine\n  }\n\n  const env = process.env;\n\n  // Tier\n  const tier = env.OPENCLAW_MEMORY_TIER || env.MEMORY_TIER;\n  if (tier && [\"lite\", \"standard\", \"full\"].includes(tier)) {\n    config.tier = tier as Tier;\n  }\n\n  // Port/Host\n  const port = env.OPENCLAW_MEMORY_PORT || env.PORT;\n  if (port) config.port = parseInt(port, 10);\n\n  const host = env.OPENCLAW_MEMORY_HOST;\n  if (host) config.host = host;\n\n  // Auth\n  const authToken = env.OPENCLAW_MEMORY_AUTH__TOKEN || env.AUTH_TOKEN || env.MEMORY_TOKEN;\n  if (authToken) {\n    config.auth = { token: authToken, enabled: true };\n  }\n\n  // SQLite\n  const sqlitePath = env.OPENCLAW_MEMORY_SQLITE__PATH || env.SQLITE_PATH;\n  if (sqlitePath) {\n    config.sqlite = { path: sqlitePath };\n  }\n\n  // Qdrant\n  const qdrantUrl = env.OPENCLAW_MEMORY_QDRANT__URL || env.QDRANT_URL;\n  if (qdrantUrl) {\n    config.qdrant = {\n      url: qdrantUrl,\n      collection: env.OPENCLAW_MEMORY_QDRANT__COLLECTION || env.QDRANT_COLLECTION || DEFAULTS.qdrant.collection,\n      apiKey: env.OPENCLAW_MEMORY_QDRANT__API_KEY,\n    };\n  }\n\n  // AGE\n  const ageHost = env.OPENCLAW_MEMORY_AGE__HOST || env.PGHOST;\n  if (ageHost) {\n    config.age = {\n      host: ageHost,\n      port: parseInt(env.OPENCLAW_MEMORY_AGE__PORT || env.PGPORT || String(DEFAULTS.age.port), 10),\n      user: env.OPENCLAW_MEMORY_AGE__USER || env.PGUSER || \"\",\n      password: env.OPENCLAW_MEMORY_AGE__PASSWORD || env.PGPASSWORD || \"\",\n      database: env.OPENCLAW_MEMORY_AGE__DATABASE || env.PGDATABASE || \"\",\n      graph: env.OPENCLAW_MEMORY_AGE__GRAPH || env.AGE_GRAPH || DEFAULTS.age.graph,\n    };\n  }\n\n  // Embedding\n  const embeddingApiKey = env.OPENCLAW_MEMORY_EMBEDDING__API_KEY || env.OPENROUTER_API_KEY || env.OPENAI_API_KEY;\n  if (embeddingApiKey) {\n    config.embedding = {\n      apiKey: embeddingApiKey,\n      baseUrl: env.OPENCLAW_MEMORY_EMBEDDING__BASE_URL || env.EMBEDDING_BASE_URL,\n      model: env.OPENCLAW_MEMORY_EMBEDDING__MODEL || env.EMBEDDING_MODEL || DEFAULTS.embedding.model,\n      dimensions: parseInt(env.OPENCLAW_MEMORY_EMBEDDING__DIMENSIONS || String(DEFAULTS.embedding.dimensions), 10),\n    };\n  }\n\n  // Extraction\n  const extractionApiKey = env.OPENCLAW_MEMORY_EXTRACTION__API_KEY || env.OPENROUTER_API_KEY || env.OPENAI_API_KEY;\n  if (extractionApiKey) {\n    config.extraction = {\n      apiKey: extractionApiKey,\n      baseUrl: env.OPENCLAW_MEMORY_EXTRACTION__BASE_URL || env.EXTRACTION_BASE_URL,\n      model: env.OPENCLAW_MEMORY_EXTRACTION__MODEL || env.EXTRACTION_MODEL || DEFAULTS.extraction.model,\n      enabled: env.OPENCLAW_MEMORY_EXTRACTION__ENABLED !== \"false\",\n    };\n  }\n\n  return config;\n}\n\n// ── Tier Inference ──────────────────────────────────────────────────────\n\nfunction inferTier(config: Partial<Config>): Tier {\n  if (config.tier) return config.tier;\n  if (config.qdrant && config.age) return \"full\";\n  if (config.qdrant) return \"standard\";\n  return \"lite\";\n}\n\n// ── Config Resolution ───────────────────────────────────────────────────\n\nexport async function loadConfig(configPath?: string): Promise<ResolvedConfig> {\n  // 1. Load from file\n  const fileConfig = await loadConfigFile(configPath);\n\n  // 2. Load from env\n  const envConfig = loadFromEnv();\n\n  // 3. Merge: file < env (env wins)\n  const merged: Partial<Config> = {\n    ...fileConfig,\n    ...envConfig,\n    // Deep merge nested objects\n    auth: { ...fileConfig?.auth, ...envConfig.auth },\n    sqlite: { ...fileConfig?.sqlite, ...envConfig.sqlite },\n  };\n\n  if (envConfig.qdrant || fileConfig?.qdrant) {\n    merged.qdrant = { ...fileConfig?.qdrant, ...envConfig.qdrant } as Config[\"qdrant\"];\n  }\n  if (envConfig.age || fileConfig?.age) {\n    merged.age = { ...fileConfig?.age, ...envConfig.age } as Config[\"age\"];\n  }\n  if (envConfig.embedding || fileConfig?.embedding) {\n    merged.embedding = { ...fileConfig?.embedding, ...envConfig.embedding } as Config[\"embedding\"];\n  }\n  if (envConfig.extraction || fileConfig?.extraction) {\n    merged.extraction = { ...fileConfig?.extraction, ...envConfig.extraction } as Config[\"extraction\"];\n  }\n\n  // 4. Infer tier\n  const tier = inferTier(merged);\n\n  // 5. Resolve defaults\n  const sqlitePath = expandHome(merged.sqlite?.path || DEFAULTS.sqlite.path);\n\n  // 6. Resolve optional layers based on tier\n  let qdrant: QdrantConfig | null = null;\n  if (tier !== \"lite\" && merged.qdrant?.url) {\n    qdrant = {\n      url: merged.qdrant.url,\n      collection: merged.qdrant.collection || DEFAULTS.qdrant.collection,\n      apiKey: merged.qdrant.apiKey,\n    };\n  }\n\n  let age: AgeConfig | null = null;\n  if (tier === \"full\" && merged.age?.host) {\n    if (!merged.age.user || !merged.age.password || !merged.age.database) {\n      throw new ConfigError(\"Full tier requires age.user, age.password, and age.database\");\n    }\n    age = {\n      host: merged.age.host,\n      port: merged.age.port || DEFAULTS.age.port,\n      user: merged.age.user,\n      password: merged.age.password,\n      database: merged.age.database,\n      graph: merged.age.graph || DEFAULTS.age.graph,\n    };\n  }\n\n  let embedding: EmbeddingConfig | null = null;\n  if (tier !== \"lite\" && merged.embedding?.apiKey) {\n    embedding = {\n      apiKey: merged.embedding.apiKey,\n      baseUrl: merged.embedding.baseUrl,\n      model: merged.embedding.model || DEFAULTS.embedding.model,\n      dimensions: merged.embedding.dimensions || DEFAULTS.embedding.dimensions,\n    };\n  }\n\n  let extraction: ExtractionConfig | null = null;\n  if (tier !== \"lite\" && merged.extraction?.apiKey) {\n    extraction = {\n      apiKey: merged.extraction.apiKey,\n      baseUrl: merged.extraction.baseUrl,\n      model: merged.extraction.model || DEFAULTS.extraction.model,\n      enabled: merged.extraction.enabled ?? DEFAULTS.extraction.enabled,\n    };\n  }\n\n  return {\n    tier,\n    port: merged.port || DEFAULTS.port,\n    host: merged.host || DEFAULTS.host,\n    auth: {\n      token: merged.auth?.token,\n      enabled: merged.auth?.enabled ?? DEFAULTS.auth.enabled,\n    },\n    sqlite: { path: sqlitePath },\n    qdrant,\n    age,\n    embedding,\n    extraction,\n    agents: merged.agents || fileConfig?.agents || [],\n  };\n}\n\n// ── defineConfig helper for config files ────────────────────────────────\n\nexport function defineConfig(config: Config): Config {\n  return config;\n}\n\n// ── Config summary (redacted) for logging ───────────────────────────────\n\nexport function configSummary(config: ResolvedConfig): string {\n  const lines: string[] = [\n    `Tier: ${config.tier}`,\n    `Port: ${config.port}`,\n    `Host: ${config.host}`,\n    `SQLite: ${config.sqlite.path}`,\n    `Auth: ${config.auth.enabled ? \"enabled\" : \"disabled\"}`,\n  ];\n\n  if (config.qdrant) {\n    lines.push(`Qdrant: ${config.qdrant.url} (collection: ${config.qdrant.collection})`);\n  }\n  if (config.age) {\n    lines.push(`AGE: ${config.age.host}:${config.age.port}/${config.age.database}`);\n  }\n  if (config.embedding) {\n    lines.push(`Embedding: ${config.embedding.model}${config.embedding.baseUrl ? ` via ${config.embedding.baseUrl}` : \"\"}`);\n  }\n  if (config.extraction) {\n    lines.push(`Extraction: ${config.extraction.model}${config.extraction.enabled ? \"\" : \" (disabled)\"}`);\n  }\n\n  return lines.join(\"\\n\");\n}\n","// ── Custom Error Classes ────────────────────────────────────────────────\n\nexport class MemoryError extends Error {\n  constructor(message: string, public readonly code: string) {\n    super(message);\n    this.name = \"MemoryError\";\n  }\n}\n\nexport class ConfigError extends MemoryError {\n  constructor(message: string) {\n    super(message, \"CONFIG_ERROR\");\n    this.name = \"ConfigError\";\n  }\n}\n\nexport class StorageError extends MemoryError {\n  constructor(message: string, public readonly layer: \"sqlite\" | \"qdrant\" | \"age\") {\n    super(message, \"STORAGE_ERROR\");\n    this.name = \"StorageError\";\n  }\n}\n\nexport class ValidationError extends MemoryError {\n  constructor(message: string, public readonly details?: unknown) {\n    super(message, \"VALIDATION_ERROR\");\n    this.name = \"ValidationError\";\n  }\n}\n\nexport class NotFoundError extends MemoryError {\n  constructor(resource: string, id: string) {\n    super(`${resource} not found: ${id}`, \"NOT_FOUND\");\n    this.name = \"NotFoundError\";\n  }\n}\n\nexport class AuthError extends MemoryError {\n  constructor(message: string = \"Unauthorized\") {\n    super(message, \"AUTH_ERROR\");\n    this.name = \"AuthError\";\n  }\n}\n","// ── Default Configuration Values ────────────────────────────────────────\n\nexport const DEFAULTS = {\n  port: 7777,\n  host: \"0.0.0.0\",\n  sqlite: {\n    path: \"~/.openclaw-memory/memory.sqlite\",\n  },\n  qdrant: {\n    collection: \"openclaw_memories\",\n  },\n  age: {\n    port: 5432,\n    graph: \"agent_memory\",\n  },\n  embedding: {\n    model: \"text-embedding-3-small\",\n    dimensions: 1536,\n  },\n  extraction: {\n    model: \"gpt-4o-mini\",\n    enabled: true,\n  },\n  auth: {\n    enabled: true,\n  },\n} as const;\n"],"mappings":"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","names":[]}