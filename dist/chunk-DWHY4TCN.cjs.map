{"version":3,"sources":["/Users/robertpop/work/personal/openclaw-memory/dist/chunk-DWHY4TCN.cjs","../src/server.ts","../src/api/router.ts","../src/api/memories.ts","../src/api/search.ts","../src/api/conversations.ts","../src/api/entities.ts","../src/api/admin.ts"],"names":["t","Elysia","path"],"mappings":"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","file":"/Users/robertpop/work/personal/openclaw-memory/dist/chunk-DWHY4TCN.cjs","sourcesContent":[null,"import { fileURLToPath } from \"node:url\";\nimport { resolve } from \"node:path\";\nimport { loadConfig, configSummary } from \"./config/index.js\";\nimport { StorageOrchestrator } from \"./storage/orchestrator.js\";\nimport { createApp } from \"./api/router.js\";\n\n// ── Server Entry Point ──────────────────────────────────────────────────\n\nexport async function createServer(configPath?: string) {\n  const config = await loadConfig(configPath);\n  const orchestrator = new StorageOrchestrator(config);\n  await orchestrator.init();\n\n  const app = createApp(orchestrator, config);\n\n  return { app, orchestrator, config };\n}\n\n// ── Main ────────────────────────────────────────────────────────────────\n\nasync function main() {\n  console.log(\"┌──────────────────────────────────────────┐\");\n  console.log(\"│       openclaw-memory service v0.1.0      │\");\n  console.log(\"│       Triple-Layer Memory System          │\");\n  console.log(\"└──────────────────────────────────────────┘\");\n\n  const { app, orchestrator, config } = await createServer();\n\n  console.log(\"[config]\");\n  console.log(configSummary(config).split(\"\\n\").map((l) => `  ${l}`).join(\"\\n\"));\n\n  app.listen(config.port);\n  console.log(`[server] Listening on http://${config.host}:${config.port}`);\n  console.log(`[server] Health check: http://localhost:${config.port}/api/health`);\n\n  const shutdown = async () => {\n    console.log(\"\\n[server] Shutting down...\");\n    await orchestrator.close();\n    process.exit(0);\n  };\n\n  process.on(\"SIGINT\", shutdown);\n  process.on(\"SIGTERM\", shutdown);\n}\n\n// Run if executed directly (works in both Bun and Node ESM)\nfunction isMainModule(): boolean {\n  try {\n    // Bun runtime\n    if (typeof globalThis.Bun !== \"undefined\") {\n      const bun = globalThis.Bun as { main?: string };\n      return bun.main === fileURLToPath(import.meta.url);\n    }\n    // Node.js\n    if (process.argv[1]) {\n      return resolve(process.argv[1]) === resolve(fileURLToPath(import.meta.url));\n    }\n    return false;\n  } catch {\n    return false;\n  }\n}\n\nif (isMainModule()) {\n  main().catch((error) => {\n    console.error(\"[fatal]\", error);\n    process.exit(1);\n  });\n}\n","import { Elysia } from \"elysia\";\nimport { cors } from \"@elysiajs/cors\";\nimport type { ResolvedConfig } from \"../config/index.js\";\nimport type { StorageOrchestrator } from \"../storage/orchestrator.js\";\nimport { AuthError, MemoryError, NotFoundError, ValidationError } from \"../core/errors.js\";\nimport { memoriesRoutes } from \"./memories.js\";\nimport { searchRoutes } from \"./search.js\";\nimport { conversationRoutes } from \"./conversations.js\";\nimport { entityRoutes } from \"./entities.js\";\nimport { adminRoutes } from \"./admin.js\";\n\n// ── App Router ──────────────────────────────────────────────────────────\n\nexport function createApp(orchestrator: StorageOrchestrator, config: ResolvedConfig) {\n  const app = new Elysia()\n    .use(cors())\n\n    // ── Auth Middleware ────────────────────────────────────────────────\n    .derive(({ headers, set, path }) => {\n      // Skip auth for health check\n      if (path === \"/api/health\") return {};\n\n      // Skip auth if disabled\n      if (!config.auth.enabled || !config.auth.token) return {};\n\n      const authHeader = headers.authorization;\n      if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\n        set.status = 401;\n        throw new AuthError(\"Missing or invalid Authorization header\");\n      }\n\n      const token = authHeader.slice(7);\n      if (token !== config.auth.token) {\n        set.status = 403;\n        throw new AuthError(\"Invalid token\");\n      }\n\n      return {};\n    })\n\n    // ── Error Handler ─────────────────────────────────────────────────\n    .onError(({ code, error, set }) => {\n      // Handle AuthError\n      if (error instanceof AuthError) {\n        const status = error.message.includes(\"Invalid token\") ? 403 : 401;\n        set.status = status;\n        return { error: error.message, code: error.code };\n      }\n\n      // Handle other custom errors\n      if (error instanceof NotFoundError) {\n        set.status = 404;\n        return { error: error.message, code: error.code };\n      }\n\n      if (error instanceof ValidationError) {\n        set.status = 400;\n        return { error: error.message, code: error.code, details: error.details };\n      }\n\n      if (error instanceof MemoryError) {\n        set.status = 500;\n        return { error: error.message, code: error.code };\n      }\n\n      // Elysia validation errors\n      if (code === \"VALIDATION\") {\n        const msg = error && \"message\" in error ? (error as Error).message : String(error);\n        set.status = 400;\n        return { error: \"Validation error\", details: msg };\n      }\n\n      // Unknown errors\n      const msg = error instanceof Error ? error.stack || error.message : String(error);\n      console.error(`[api] Unhandled error: ${msg}`);\n      set.status = 500;\n      return { error: \"Internal server error\" };\n    })\n\n    // ── Mount Routes ──────────────────────────────────────────────────\n    .use(memoriesRoutes(orchestrator))\n    .use(searchRoutes(orchestrator))\n    .use(conversationRoutes(orchestrator, config))\n    .use(entityRoutes(orchestrator))\n    .use(adminRoutes(orchestrator));\n\n  return app;\n}\n","import { Elysia, t } from \"elysia\";\nimport type { StorageOrchestrator } from \"../storage/orchestrator.js\";\nimport type { CreateMemoryRequest, UpdateMemoryRequest, MemoryScope, MemorySource } from \"../core/types.js\";\n\n// ── Memory CRUD Routes ──────────────────────────────────────────────────\n\nexport function memoriesRoutes(orchestrator: StorageOrchestrator) {\n  return new Elysia({ prefix: \"/api/memories\" })\n    // POST /api/memories — Create a new memory\n    .post(\n      \"/\",\n      async ({ body, set }) => {\n        try {\n          const result = await orchestrator.createMemory(body as CreateMemoryRequest);\n          set.status = 201;\n          return result;\n        } catch (error) {\n          set.status = 500;\n          return {\n            error: \"Failed to create memory\",\n            details: error instanceof Error ? error.message : String(error),\n          };\n        }\n      },\n      {\n        body: t.Object({\n          agent_id: t.String(),\n          scope: t.Union([\n            t.Literal(\"user\"),\n            t.Literal(\"agent\"),\n            t.Literal(\"global\"),\n            t.Literal(\"project\"),\n            t.Literal(\"session\"),\n          ]),\n          subject_id: t.Optional(t.Nullable(t.String())),\n          content: t.String(),\n          tags: t.Optional(t.Array(t.String())),\n          source: t.Optional(\n            t.Union([\n              t.Literal(\"explicit\"),\n              t.Literal(\"derived\"),\n              t.Literal(\"observation\"),\n              t.Literal(\"conversation_summary\"),\n              t.Literal(\"entity_extraction\"),\n              t.Literal(\"daily_digest\"),\n              t.Literal(\"migration\"),\n            ])\n          ),\n          created_by: t.Optional(t.Nullable(t.String())),\n          extract_entities: t.Optional(t.Boolean()),\n          expires_at: t.Optional(t.Nullable(t.String())),\n        }),\n      }\n    )\n\n    // GET /api/memories/:id — Get a memory by ID\n    .get(\"/:id\", ({ params, set }) => {\n      const memory = orchestrator.sqlite.getMemory(params.id);\n      if (!memory) {\n        set.status = 404;\n        return { error: \"Memory not found\" };\n      }\n      return memory;\n    })\n\n    // PUT /api/memories/:id — Update a memory\n    .put(\n      \"/:id\",\n      async ({ params, body, set }) => {\n        try {\n          const result = await orchestrator.updateMemory(\n            params.id,\n            body as UpdateMemoryRequest\n          );\n          if (!result) {\n            set.status = 404;\n            return { error: \"Memory not found\" };\n          }\n          return result;\n        } catch (error) {\n          set.status = 500;\n          return {\n            error: \"Failed to update memory\",\n            details: error instanceof Error ? error.message : String(error),\n          };\n        }\n      },\n      {\n        body: t.Object({\n          content: t.Optional(t.String()),\n          tags: t.Optional(t.Array(t.String())),\n          scope: t.Optional(\n            t.Union([\n              t.Literal(\"user\"),\n              t.Literal(\"agent\"),\n              t.Literal(\"global\"),\n              t.Literal(\"project\"),\n              t.Literal(\"session\"),\n            ])\n          ),\n          subject_id: t.Optional(t.Nullable(t.String())),\n          expires_at: t.Optional(t.Nullable(t.String())),\n          extract_entities: t.Optional(t.Boolean()),\n        }),\n      }\n    )\n\n    // DELETE /api/memories/:id — Delete a memory\n    .delete(\"/:id\", async ({ params, set }) => {\n      try {\n        const deleted = await orchestrator.deleteMemory(params.id);\n        if (!deleted) {\n          set.status = 404;\n          return { error: \"Memory not found\" };\n        }\n        return { deleted: true, id: params.id };\n      } catch (error) {\n        set.status = 500;\n        return {\n          error: \"Failed to delete memory\",\n          details: error instanceof Error ? error.message : String(error),\n        };\n      }\n    })\n\n    // GET /api/memories — List memories with filters\n    .get(\"/\", ({ query }) => {\n      const memories = orchestrator.sqlite.listMemories({\n        agent_id: query.agent_id as string | undefined,\n        scope: query.scope as MemoryScope | undefined,\n        subject_id: query.subject_id as string | undefined,\n        source: query.source as MemorySource | undefined,\n        tags: query.tags as string | undefined,\n        limit: query.limit ? parseInt(String(query.limit), 10) : undefined,\n        offset: query.offset ? parseInt(String(query.offset), 10) : undefined,\n        order: (query.order as \"asc\" | \"desc\") || \"desc\",\n      });\n      return { memories, count: memories.length };\n    });\n}\n","import { Elysia, t } from \"elysia\";\nimport { SearchEngine } from \"../search/engine.js\";\nimport type { StorageOrchestrator } from \"../storage/orchestrator.js\";\nimport type { SearchRequest } from \"../core/types.js\";\n\n// ── Search Routes ───────────────────────────────────────────────────────\n\nconst scopeEnum = t.Union([\n  t.Literal(\"user\"),\n  t.Literal(\"agent\"),\n  t.Literal(\"global\"),\n  t.Literal(\"project\"),\n  t.Literal(\"session\"),\n]);\n\nexport function searchRoutes(orchestrator: StorageOrchestrator) {\n  const searchEngine = new SearchEngine(orchestrator);\n\n  return new Elysia({ prefix: \"/api/search\" })\n    // POST /api/search — Smart search (auto-selects layers)\n    .post(\n      \"/\",\n      async ({ body, set }) => {\n        try {\n          const req = body as SearchRequest;\n          if (!req.agent_id) req.cross_agent = true;\n          return await searchEngine.search(req);\n        } catch (error) {\n          set.status = 500;\n          return {\n            error: \"Search failed\",\n            details: error instanceof Error ? error.message : String(error),\n          };\n        }\n      },\n      {\n        body: t.Object({\n          agent_id: t.Optional(t.String()),\n          query: t.String(),\n          scopes: t.Optional(t.Array(scopeEnum)),\n          subject_id: t.Optional(t.Nullable(t.String())),\n          limit: t.Optional(t.Number()),\n          include_graph: t.Optional(t.Boolean()),\n          cross_agent: t.Optional(t.Boolean()),\n          strategy: t.Optional(\n            t.Union([\n              t.Literal(\"auto\"),\n              t.Literal(\"semantic\"),\n              t.Literal(\"fulltext\"),\n              t.Literal(\"graph\"),\n              t.Literal(\"all\"),\n            ])\n          ),\n        }),\n      }\n    )\n\n    // POST /api/search/semantic — Force Qdrant semantic search\n    .post(\n      \"/semantic\",\n      async ({ body, set }) => {\n        try {\n          const req = { ...(body as SearchRequest), strategy: \"semantic\" as const };\n          if (!req.agent_id) req.cross_agent = true;\n          return await searchEngine.search(req);\n        } catch (error) {\n          set.status = 500;\n          return {\n            error: \"Semantic search failed\",\n            details: error instanceof Error ? error.message : String(error),\n          };\n        }\n      },\n      {\n        body: t.Object({\n          agent_id: t.Optional(t.String()),\n          query: t.String(),\n          scopes: t.Optional(t.Array(scopeEnum)),\n          subject_id: t.Optional(t.Nullable(t.String())),\n          limit: t.Optional(t.Number()),\n          cross_agent: t.Optional(t.Boolean()),\n        }),\n      }\n    )\n\n    // POST /api/search/graph — Force AGE graph traversal\n    .post(\n      \"/graph\",\n      async ({ body, set }) => {\n        try {\n          const req = {\n            ...(body as SearchRequest),\n            strategy: \"graph\" as const,\n            include_graph: true,\n          };\n          if (!req.agent_id) req.cross_agent = true;\n          return await searchEngine.search(req);\n        } catch (error) {\n          set.status = 500;\n          return {\n            error: \"Graph search failed\",\n            details: error instanceof Error ? error.message : String(error),\n          };\n        }\n      },\n      {\n        body: t.Object({\n          agent_id: t.Optional(t.String()),\n          query: t.String(),\n          scopes: t.Optional(t.Array(scopeEnum)),\n          subject_id: t.Optional(t.Nullable(t.String())),\n          limit: t.Optional(t.Number()),\n        }),\n      }\n    )\n\n    // POST /api/search/fulltext — Force SQLite FTS search\n    .post(\n      \"/fulltext\",\n      async ({ body, set }) => {\n        try {\n          const req = {\n            ...(body as SearchRequest),\n            strategy: \"fulltext\" as const,\n            include_graph: false,\n          };\n          if (!req.agent_id) req.cross_agent = true;\n          return await searchEngine.search(req);\n        } catch (error) {\n          set.status = 500;\n          return {\n            error: \"Fulltext search failed\",\n            details: error instanceof Error ? error.message : String(error),\n          };\n        }\n      },\n      {\n        body: t.Object({\n          agent_id: t.Optional(t.String()),\n          query: t.String(),\n          scopes: t.Optional(t.Array(t.String())),\n          subject_id: t.Optional(t.Nullable(t.String())),\n          limit: t.Optional(t.Number()),\n        }),\n      }\n    );\n}\n","import { Elysia, t } from \"elysia\";\nimport type { StorageOrchestrator } from \"../storage/orchestrator.js\";\nimport type { ResolvedConfig } from \"../config/index.js\";\nimport { ConversationSummarizer } from \"../extraction/summarizer.js\";\nimport type { ConversationLogEntry, CreateMemoryRequest, SummarizeResponse } from \"../core/types.js\";\n\n// ── Conversation Routes ─────────────────────────────────────────────────\n\nexport function conversationRoutes(\n  orchestrator: StorageOrchestrator,\n  config: ResolvedConfig\n) {\n  // Summarizer is only available if extraction config is present\n  const summarizer = config.extraction\n    ? new ConversationSummarizer({\n        apiKey: config.extraction.apiKey,\n        baseUrl: config.extraction.baseUrl,\n        model: config.extraction.model,\n      })\n    : null;\n\n  return new Elysia({ prefix: \"/api/conversations\" })\n    // POST /api/conversations/log — Append conversation entry\n    .post(\n      \"/log\",\n      ({ body, set }) => {\n        try {\n          orchestrator.sqlite.appendConversationLog(body as ConversationLogEntry);\n          set.status = 201;\n          return { ok: true };\n        } catch (error) {\n          set.status = 500;\n          return {\n            error: \"Failed to append conversation log\",\n            details: error instanceof Error ? error.message : String(error),\n          };\n        }\n      },\n      {\n        body: t.Object({\n          agent_id: t.String(),\n          session_id: t.String(),\n          user_id: t.String(),\n          channel: t.String(),\n          role: t.Union([\n            t.Literal(\"user\"),\n            t.Literal(\"assistant\"),\n            t.Literal(\"system\"),\n          ]),\n          content: t.String(),\n          timestamp: t.String(),\n        }),\n      }\n    )\n\n    // POST /api/conversations/summarize — Summarize a session\n    .post(\n      \"/summarize\",\n      async ({ body, set }) => {\n        if (!summarizer) {\n          set.status = 501;\n          return { error: \"Summarization not available — extraction config required\" };\n        }\n\n        try {\n          const { agent_id, session_id, user_id, channel, messages } = body;\n\n          const summary = await summarizer.summarize(messages);\n          if (!summary) {\n            set.status = 422;\n            return { error: \"Failed to generate summary\" };\n          }\n\n          const memoryReq: CreateMemoryRequest = {\n            agent_id,\n            scope: \"session\",\n            subject_id: user_id,\n            content: summary,\n            tags: [\"conversation_summary\", channel, `session:${session_id}`],\n            source: \"conversation_summary\",\n            created_by: agent_id,\n            extract_entities: true,\n          };\n\n          const result = await orchestrator.createMemory(memoryReq);\n\n          const response: SummarizeResponse = {\n            memory_id: result.id,\n            summary,\n            entities_extracted: result.entities,\n            relationships_created: 0,\n          };\n\n          set.status = 201;\n          return response;\n        } catch (error) {\n          set.status = 500;\n          return {\n            error: \"Summarization failed\",\n            details: error instanceof Error ? error.message : String(error),\n          };\n        }\n      },\n      {\n        body: t.Object({\n          agent_id: t.String(),\n          session_id: t.String(),\n          user_id: t.String(),\n          channel: t.String(),\n          messages: t.Array(\n            t.Object({\n              role: t.Union([\n                t.Literal(\"user\"),\n                t.Literal(\"assistant\"),\n                t.Literal(\"system\"),\n              ]),\n              content: t.String(),\n              timestamp: t.String(),\n            })\n          ),\n          reason: t.Optional(t.String()),\n        }),\n      }\n    );\n}\n","import { Elysia, t } from \"elysia\";\nimport type { StorageOrchestrator } from \"../storage/orchestrator.js\";\n\n// ── Entity Routes ───────────────────────────────────────────────────────\n\nexport function entityRoutes(orchestrator: StorageOrchestrator) {\n  return new Elysia({ prefix: \"/api/entities\" })\n    // GET /api/entities/:type — List entities by type\n    .get(\"/:type\", async ({ params, query, set }) => {\n      if (!orchestrator.age) {\n        set.status = 501;\n        return { error: \"Graph layer not available — requires Full tier\" };\n      }\n\n      try {\n        const entities = await orchestrator.age.listEntities(\n          params.type,\n          query.agent_id as string | undefined,\n          query.limit ? parseInt(String(query.limit), 10) : 50\n        );\n        return { entities, count: entities.length };\n      } catch (error) {\n        set.status = 500;\n        return {\n          error: \"Failed to list entities\",\n          details: error instanceof Error ? error.message : String(error),\n        };\n      }\n    })\n\n    // GET /api/entities/:type/:id — Get entity with relationships\n    .get(\"/:type/:id\", async ({ params, set }) => {\n      if (!orchestrator.age) {\n        set.status = 501;\n        return { error: \"Graph layer not available — requires Full tier\" };\n      }\n\n      try {\n        const result = await orchestrator.age.getEntityWithRelationships(\n          params.type,\n          params.id\n        );\n        if (!result.entity) {\n          set.status = 404;\n          return { error: \"Entity not found\" };\n        }\n        return result;\n      } catch (error) {\n        set.status = 500;\n        return {\n          error: \"Failed to get entity\",\n          details: error instanceof Error ? error.message : String(error),\n        };\n      }\n    })\n\n    // GET /api/entities/:type/:id/related — Get related entities\n    .get(\"/:type/:id/related\", async ({ params, query, set }) => {\n      if (!orchestrator.age) {\n        set.status = 501;\n        return { error: \"Graph layer not available — requires Full tier\" };\n      }\n\n      try {\n        const depth = query.depth ? parseInt(String(query.depth), 10) : 2;\n        const related = await orchestrator.age.getRelatedEntities(\n          params.id,\n          depth\n        );\n        return { related, count: related.length };\n      } catch (error) {\n        set.status = 500;\n        return {\n          error: \"Failed to get related entities\",\n          details: error instanceof Error ? error.message : String(error),\n        };\n      }\n    })\n\n    // POST /api/entities/extract — Manually trigger entity extraction\n    .post(\n      \"/extract\",\n      async ({ body, set }) => {\n        if (!orchestrator.entityExtractor) {\n          set.status = 501;\n          return { error: \"Entity extraction not available — requires extraction config\" };\n        }\n\n        try {\n          const result = await orchestrator.entityExtractor.extract(body.text);\n          return result;\n        } catch (error) {\n          set.status = 500;\n          return {\n            error: \"Entity extraction failed\",\n            details: error instanceof Error ? error.message : String(error),\n          };\n        }\n      },\n      {\n        body: t.Object({\n          text: t.String(),\n        }),\n      }\n    );\n}\n","import { Elysia, t } from \"elysia\";\nimport fs from \"node:fs\";\nimport path from \"node:path\";\nimport type { StorageOrchestrator } from \"../storage/orchestrator.js\";\nimport type { CreateMemoryRequest, MigrateMarkdownRequest } from \"../core/types.js\";\n\n// ── Admin Routes ────────────────────────────────────────────────────────\n\nexport function adminRoutes(orchestrator: StorageOrchestrator) {\n  return new Elysia()\n    // GET /api/health — Health check\n    .get(\"/api/health\", async () => {\n      return await orchestrator.healthCheck();\n    })\n\n    // POST /api/sync/retry — Retry failed L2/L3 syncs\n    .post(\"/api/sync/retry\", async ({ set }) => {\n      try {\n        const result = await orchestrator.retrySyncQueue();\n        return result;\n      } catch (error) {\n        set.status = 500;\n        return {\n          error: \"Sync retry failed\",\n          details: error instanceof Error ? error.message : String(error),\n        };\n      }\n    })\n\n    // GET /api/sync/queue — View pending sync queue\n    .get(\"/api/sync/queue\", () => {\n      const items = orchestrator.sqlite.getSyncQueue(100);\n      return { items, count: items.length };\n    })\n\n    // POST /api/admin/migrate-markdown — Migrate markdown files\n    .post(\n      \"/api/admin/migrate-markdown\",\n      async ({ body, set }) => {\n        try {\n          const results = await migrateMarkdownFiles(orchestrator, body);\n          return results;\n        } catch (error) {\n          set.status = 500;\n          return {\n            error: \"Migration failed\",\n            details: error instanceof Error ? error.message : String(error),\n          };\n        }\n      },\n      {\n        body: t.Object({\n          markdown_paths: t.Array(t.String()),\n          agent_id: t.String(),\n          dry_run: t.Optional(t.Boolean()),\n        }),\n      }\n    )\n\n    // POST /api/admin/daily-digest — Trigger daily digest\n    .post(\"/api/admin/daily-digest\", async ({ set }) => {\n      set.status = 501;\n      return { error: \"Not yet implemented\" };\n    });\n}\n\n// ── Markdown Migration ──────────────────────────────────────────────────\n\nasync function migrateMarkdownFiles(\n  orchestrator: StorageOrchestrator,\n  request: MigrateMarkdownRequest\n): Promise<{\n  migrated: number;\n  skipped: number;\n  errors: string[];\n  memories: Array<{ id: string; content_preview: string }>;\n}> {\n  const { markdown_paths, agent_id, dry_run } = request;\n  let migrated = 0;\n  let skipped = 0;\n  const errors: string[] = [];\n  const memories: Array<{ id: string; content_preview: string }> = [];\n\n  for (const filePath of markdown_paths) {\n    try {\n      if (!fs.existsSync(filePath)) {\n        errors.push(`File not found: ${filePath}`);\n        skipped++;\n        continue;\n      }\n\n      const content = fs.readFileSync(filePath, \"utf-8\");\n      const fileName = path.basename(filePath, \".md\");\n      const sections = parseMarkdownSections(content);\n\n      for (const section of sections) {\n        if (section.content.trim().length < 10) {\n          skipped++;\n          continue;\n        }\n\n        if (dry_run) {\n          memories.push({\n            id: \"(dry-run)\",\n            content_preview: section.content.slice(0, 100),\n          });\n          migrated++;\n          continue;\n        }\n\n        const scope = inferScope(section.heading, fileName);\n        const source = inferSource(fileName);\n        const tags = inferTags(section.heading, fileName);\n\n        const req: CreateMemoryRequest = {\n          agent_id,\n          scope,\n          subject_id: null,\n          content: section.content.trim(),\n          tags,\n          source: source || \"migration\",\n          created_by: \"migration\",\n          extract_entities: true,\n        };\n\n        try {\n          const result = await orchestrator.createMemory(req);\n          memories.push({\n            id: result.id,\n            content_preview: section.content.slice(0, 100),\n          });\n          migrated++;\n        } catch (error) {\n          errors.push(\n            `Failed to migrate section \"${section.heading}\": ${error instanceof Error ? error.message : String(error)}`\n          );\n        }\n      }\n    } catch (error) {\n      errors.push(\n        `Failed to process ${filePath}: ${error instanceof Error ? error.message : String(error)}`\n      );\n    }\n  }\n\n  return { migrated, skipped, errors, memories };\n}\n\n// ── Markdown Parsing Helpers ────────────────────────────────────────────\n\ninterface MarkdownSection {\n  heading: string;\n  content: string;\n  level: number;\n}\n\nfunction parseMarkdownSections(markdown: string): MarkdownSection[] {\n  const lines = markdown.split(\"\\n\");\n  const sections: MarkdownSection[] = [];\n  let currentHeading = \"root\";\n  let currentLevel = 0;\n  let currentContent: string[] = [];\n\n  for (const line of lines) {\n    const headingMatch = line.match(/^(#{1,3})\\s+(.+)/);\n    if (headingMatch) {\n      if (currentContent.length > 0) {\n        sections.push({\n          heading: currentHeading,\n          content: currentContent.join(\"\\n\").trim(),\n          level: currentLevel,\n        });\n      }\n      currentHeading = headingMatch[2].trim();\n      currentLevel = headingMatch[1].length;\n      currentContent = [];\n    } else {\n      currentContent.push(line);\n    }\n  }\n\n  if (currentContent.length > 0) {\n    sections.push({\n      heading: currentHeading,\n      content: currentContent.join(\"\\n\").trim(),\n      level: currentLevel,\n    });\n  }\n\n  return sections;\n}\n\nfunction inferScope(heading: string, fileName: string): CreateMemoryRequest[\"scope\"] {\n  const h = heading.toLowerCase();\n  const f = fileName.toLowerCase();\n\n  if (h.includes(\"about\") || h.includes(\"personal\")) return \"user\";\n  if (h.includes(\"project\")) return \"project\";\n  if (h.includes(\"agent\")) return \"agent\";\n  if (h.includes(\"session\") || f.match(/^\\d{4}-\\d{2}-\\d{2}/)) return \"session\";\n  return \"global\";\n}\n\nfunction inferSource(fileName: string): CreateMemoryRequest[\"source\"] | null {\n  if (fileName.match(/^\\d{4}-\\d{2}-\\d{2}/)) return \"daily_digest\";\n  return \"migration\";\n}\n\nfunction inferTags(heading: string, fileName: string): string[] {\n  const tags: string[] = [\"migration\"];\n  if (fileName.match(/^\\d{4}-\\d{2}-\\d{2}/)) {\n    tags.push(\"daily\", fileName);\n  }\n  if (heading !== \"root\") {\n    tags.push(heading.toLowerCase().replace(/[^a-z0-9]+/g, \"-\"));\n  }\n  return tags;\n}\n"]}