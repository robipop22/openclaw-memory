{"version":3,"sources":["../src/server.ts","../src/api/router.ts","../src/api/memories.ts","../src/api/search.ts","../src/api/conversations.ts","../src/api/entities.ts","../src/api/admin.ts"],"sourcesContent":["import { fileURLToPath } from \"node:url\";\nimport { resolve } from \"node:path\";\nimport { loadConfig, configSummary } from \"./config/index.js\";\nimport { StorageOrchestrator } from \"./storage/orchestrator.js\";\nimport { createApp } from \"./api/router.js\";\n\n// ── Server Entry Point ──────────────────────────────────────────────────\n\nexport async function createServer(configPath?: string) {\n  const config = await loadConfig(configPath);\n  const orchestrator = new StorageOrchestrator(config);\n  await orchestrator.init();\n\n  const app = createApp(orchestrator, config);\n\n  return { app, orchestrator, config };\n}\n\n// ── Main ────────────────────────────────────────────────────────────────\n\nasync function main() {\n  console.log(\"┌──────────────────────────────────────────┐\");\n  console.log(\"│       openclaw-memory service v0.1.0      │\");\n  console.log(\"│       Triple-Layer Memory System          │\");\n  console.log(\"└──────────────────────────────────────────┘\");\n\n  const { app, orchestrator, config } = await createServer();\n\n  console.log(\"[config]\");\n  console.log(configSummary(config).split(\"\\n\").map((l) => `  ${l}`).join(\"\\n\"));\n\n  app.listen(config.port);\n  console.log(`[server] Listening on http://${config.host}:${config.port}`);\n  console.log(`[server] Health check: http://localhost:${config.port}/api/health`);\n\n  const shutdown = async () => {\n    console.log(\"\\n[server] Shutting down...\");\n    await orchestrator.close();\n    process.exit(0);\n  };\n\n  process.on(\"SIGINT\", shutdown);\n  process.on(\"SIGTERM\", shutdown);\n}\n\n// Run if executed directly (works in both Bun and Node ESM)\nfunction isMainModule(): boolean {\n  try {\n    // Bun runtime\n    if (typeof globalThis.Bun !== \"undefined\") {\n      const bun = globalThis.Bun as { main?: string };\n      return bun.main === fileURLToPath(import.meta.url);\n    }\n    // Node.js\n    if (process.argv[1]) {\n      return resolve(process.argv[1]) === resolve(fileURLToPath(import.meta.url));\n    }\n    return false;\n  } catch {\n    return false;\n  }\n}\n\nif (isMainModule()) {\n  main().catch((error) => {\n    console.error(\"[fatal]\", error);\n    process.exit(1);\n  });\n}\n","import { Elysia } from \"elysia\";\nimport { cors } from \"@elysiajs/cors\";\nimport type { ResolvedConfig } from \"../config/index.js\";\nimport type { StorageOrchestrator } from \"../storage/orchestrator.js\";\nimport { AuthError, MemoryError, NotFoundError, ValidationError } from \"../core/errors.js\";\nimport { memoriesRoutes } from \"./memories.js\";\nimport { searchRoutes } from \"./search.js\";\nimport { conversationRoutes } from \"./conversations.js\";\nimport { entityRoutes } from \"./entities.js\";\nimport { adminRoutes } from \"./admin.js\";\n\n// ── App Router ──────────────────────────────────────────────────────────\n\nexport function createApp(orchestrator: StorageOrchestrator, config: ResolvedConfig) {\n  const app = new Elysia()\n    .use(cors())\n\n    // ── Auth Middleware ────────────────────────────────────────────────\n    .derive(({ headers, set, path }) => {\n      // Skip auth for health check\n      if (path === \"/api/health\") return {};\n\n      // Skip auth if disabled\n      if (!config.auth.enabled || !config.auth.token) return {};\n\n      const authHeader = headers.authorization;\n      if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\n        set.status = 401;\n        throw new AuthError(\"Missing or invalid Authorization header\");\n      }\n\n      const token = authHeader.slice(7);\n      if (token !== config.auth.token) {\n        set.status = 403;\n        throw new AuthError(\"Invalid token\");\n      }\n\n      return {};\n    })\n\n    // ── Error Handler ─────────────────────────────────────────────────\n    .onError(({ code, error, set }) => {\n      // Handle AuthError\n      if (error instanceof AuthError) {\n        const status = error.message.includes(\"Invalid token\") ? 403 : 401;\n        set.status = status;\n        return { error: error.message, code: error.code };\n      }\n\n      // Handle other custom errors\n      if (error instanceof NotFoundError) {\n        set.status = 404;\n        return { error: error.message, code: error.code };\n      }\n\n      if (error instanceof ValidationError) {\n        set.status = 400;\n        return { error: error.message, code: error.code, details: error.details };\n      }\n\n      if (error instanceof MemoryError) {\n        set.status = 500;\n        return { error: error.message, code: error.code };\n      }\n\n      // Elysia validation errors\n      if (code === \"VALIDATION\") {\n        const msg = error && \"message\" in error ? (error as Error).message : String(error);\n        set.status = 400;\n        return { error: \"Validation error\", details: msg };\n      }\n\n      // Unknown errors\n      const msg = error instanceof Error ? error.stack || error.message : String(error);\n      console.error(`[api] Unhandled error: ${msg}`);\n      set.status = 500;\n      return { error: \"Internal server error\" };\n    })\n\n    // ── Mount Routes ──────────────────────────────────────────────────\n    .use(memoriesRoutes(orchestrator))\n    .use(searchRoutes(orchestrator))\n    .use(conversationRoutes(orchestrator, config))\n    .use(entityRoutes(orchestrator))\n    .use(adminRoutes(orchestrator));\n\n  return app;\n}\n","import { Elysia, t } from \"elysia\";\nimport type { StorageOrchestrator } from \"../storage/orchestrator.js\";\nimport type { CreateMemoryRequest, UpdateMemoryRequest, MemoryScope, MemorySource } from \"../core/types.js\";\n\n// ── Memory CRUD Routes ──────────────────────────────────────────────────\n\nexport function memoriesRoutes(orchestrator: StorageOrchestrator) {\n  return new Elysia({ prefix: \"/api/memories\" })\n    // POST /api/memories — Create a new memory\n    .post(\n      \"/\",\n      async ({ body, set }) => {\n        try {\n          const result = await orchestrator.createMemory(body as CreateMemoryRequest);\n          set.status = 201;\n          return result;\n        } catch (error) {\n          set.status = 500;\n          return {\n            error: \"Failed to create memory\",\n            details: error instanceof Error ? error.message : String(error),\n          };\n        }\n      },\n      {\n        body: t.Object({\n          agent_id: t.String(),\n          scope: t.Union([\n            t.Literal(\"user\"),\n            t.Literal(\"agent\"),\n            t.Literal(\"global\"),\n            t.Literal(\"project\"),\n            t.Literal(\"session\"),\n          ]),\n          subject_id: t.Optional(t.Nullable(t.String())),\n          content: t.String(),\n          tags: t.Optional(t.Array(t.String())),\n          source: t.Optional(\n            t.Union([\n              t.Literal(\"explicit\"),\n              t.Literal(\"derived\"),\n              t.Literal(\"observation\"),\n              t.Literal(\"conversation_summary\"),\n              t.Literal(\"entity_extraction\"),\n              t.Literal(\"daily_digest\"),\n              t.Literal(\"migration\"),\n            ])\n          ),\n          created_by: t.Optional(t.Nullable(t.String())),\n          extract_entities: t.Optional(t.Boolean()),\n          expires_at: t.Optional(t.Nullable(t.String())),\n        }),\n      }\n    )\n\n    // GET /api/memories/:id — Get a memory by ID\n    .get(\"/:id\", ({ params, set }) => {\n      const memory = orchestrator.sqlite.getMemory(params.id);\n      if (!memory) {\n        set.status = 404;\n        return { error: \"Memory not found\" };\n      }\n      return memory;\n    })\n\n    // PUT /api/memories/:id — Update a memory\n    .put(\n      \"/:id\",\n      async ({ params, body, set }) => {\n        try {\n          const result = await orchestrator.updateMemory(\n            params.id,\n            body as UpdateMemoryRequest\n          );\n          if (!result) {\n            set.status = 404;\n            return { error: \"Memory not found\" };\n          }\n          return result;\n        } catch (error) {\n          set.status = 500;\n          return {\n            error: \"Failed to update memory\",\n            details: error instanceof Error ? error.message : String(error),\n          };\n        }\n      },\n      {\n        body: t.Object({\n          content: t.Optional(t.String()),\n          tags: t.Optional(t.Array(t.String())),\n          scope: t.Optional(\n            t.Union([\n              t.Literal(\"user\"),\n              t.Literal(\"agent\"),\n              t.Literal(\"global\"),\n              t.Literal(\"project\"),\n              t.Literal(\"session\"),\n            ])\n          ),\n          subject_id: t.Optional(t.Nullable(t.String())),\n          expires_at: t.Optional(t.Nullable(t.String())),\n          extract_entities: t.Optional(t.Boolean()),\n        }),\n      }\n    )\n\n    // DELETE /api/memories/:id — Delete a memory\n    .delete(\"/:id\", async ({ params, set }) => {\n      try {\n        const deleted = await orchestrator.deleteMemory(params.id);\n        if (!deleted) {\n          set.status = 404;\n          return { error: \"Memory not found\" };\n        }\n        return { deleted: true, id: params.id };\n      } catch (error) {\n        set.status = 500;\n        return {\n          error: \"Failed to delete memory\",\n          details: error instanceof Error ? error.message : String(error),\n        };\n      }\n    })\n\n    // GET /api/memories — List memories with filters\n    .get(\"/\", ({ query }) => {\n      const memories = orchestrator.sqlite.listMemories({\n        agent_id: query.agent_id as string | undefined,\n        scope: query.scope as MemoryScope | undefined,\n        subject_id: query.subject_id as string | undefined,\n        source: query.source as MemorySource | undefined,\n        tags: query.tags as string | undefined,\n        limit: query.limit ? parseInt(String(query.limit), 10) : undefined,\n        offset: query.offset ? parseInt(String(query.offset), 10) : undefined,\n        order: (query.order as \"asc\" | \"desc\") || \"desc\",\n      });\n      return { memories, count: memories.length };\n    });\n}\n","import { Elysia, t } from \"elysia\";\nimport { SearchEngine } from \"../search/engine.js\";\nimport type { StorageOrchestrator } from \"../storage/orchestrator.js\";\nimport type { SearchRequest } from \"../core/types.js\";\n\n// ── Search Routes ───────────────────────────────────────────────────────\n\nconst scopeEnum = t.Union([\n  t.Literal(\"user\"),\n  t.Literal(\"agent\"),\n  t.Literal(\"global\"),\n  t.Literal(\"project\"),\n  t.Literal(\"session\"),\n]);\n\nexport function searchRoutes(orchestrator: StorageOrchestrator) {\n  const searchEngine = new SearchEngine(orchestrator);\n\n  return new Elysia({ prefix: \"/api/search\" })\n    // POST /api/search — Smart search (auto-selects layers)\n    .post(\n      \"/\",\n      async ({ body, set }) => {\n        try {\n          const req = body as SearchRequest;\n          if (!req.agent_id) req.cross_agent = true;\n          return await searchEngine.search(req);\n        } catch (error) {\n          set.status = 500;\n          return {\n            error: \"Search failed\",\n            details: error instanceof Error ? error.message : String(error),\n          };\n        }\n      },\n      {\n        body: t.Object({\n          agent_id: t.Optional(t.String()),\n          query: t.String(),\n          scopes: t.Optional(t.Array(scopeEnum)),\n          subject_id: t.Optional(t.Nullable(t.String())),\n          limit: t.Optional(t.Number()),\n          include_graph: t.Optional(t.Boolean()),\n          cross_agent: t.Optional(t.Boolean()),\n          strategy: t.Optional(\n            t.Union([\n              t.Literal(\"auto\"),\n              t.Literal(\"semantic\"),\n              t.Literal(\"fulltext\"),\n              t.Literal(\"graph\"),\n              t.Literal(\"all\"),\n            ])\n          ),\n        }),\n      }\n    )\n\n    // POST /api/search/semantic — Force Qdrant semantic search\n    .post(\n      \"/semantic\",\n      async ({ body, set }) => {\n        try {\n          const req = { ...(body as SearchRequest), strategy: \"semantic\" as const };\n          if (!req.agent_id) req.cross_agent = true;\n          return await searchEngine.search(req);\n        } catch (error) {\n          set.status = 500;\n          return {\n            error: \"Semantic search failed\",\n            details: error instanceof Error ? error.message : String(error),\n          };\n        }\n      },\n      {\n        body: t.Object({\n          agent_id: t.Optional(t.String()),\n          query: t.String(),\n          scopes: t.Optional(t.Array(scopeEnum)),\n          subject_id: t.Optional(t.Nullable(t.String())),\n          limit: t.Optional(t.Number()),\n          cross_agent: t.Optional(t.Boolean()),\n        }),\n      }\n    )\n\n    // POST /api/search/graph — Force AGE graph traversal\n    .post(\n      \"/graph\",\n      async ({ body, set }) => {\n        try {\n          const req = {\n            ...(body as SearchRequest),\n            strategy: \"graph\" as const,\n            include_graph: true,\n          };\n          if (!req.agent_id) req.cross_agent = true;\n          return await searchEngine.search(req);\n        } catch (error) {\n          set.status = 500;\n          return {\n            error: \"Graph search failed\",\n            details: error instanceof Error ? error.message : String(error),\n          };\n        }\n      },\n      {\n        body: t.Object({\n          agent_id: t.Optional(t.String()),\n          query: t.String(),\n          scopes: t.Optional(t.Array(scopeEnum)),\n          subject_id: t.Optional(t.Nullable(t.String())),\n          limit: t.Optional(t.Number()),\n        }),\n      }\n    )\n\n    // POST /api/search/fulltext — Force SQLite FTS search\n    .post(\n      \"/fulltext\",\n      async ({ body, set }) => {\n        try {\n          const req = {\n            ...(body as SearchRequest),\n            strategy: \"fulltext\" as const,\n            include_graph: false,\n          };\n          if (!req.agent_id) req.cross_agent = true;\n          return await searchEngine.search(req);\n        } catch (error) {\n          set.status = 500;\n          return {\n            error: \"Fulltext search failed\",\n            details: error instanceof Error ? error.message : String(error),\n          };\n        }\n      },\n      {\n        body: t.Object({\n          agent_id: t.Optional(t.String()),\n          query: t.String(),\n          scopes: t.Optional(t.Array(t.String())),\n          subject_id: t.Optional(t.Nullable(t.String())),\n          limit: t.Optional(t.Number()),\n        }),\n      }\n    );\n}\n","import { Elysia, t } from \"elysia\";\nimport type { StorageOrchestrator } from \"../storage/orchestrator.js\";\nimport type { ResolvedConfig } from \"../config/index.js\";\nimport { ConversationSummarizer } from \"../extraction/summarizer.js\";\nimport type { ConversationLogEntry, CreateMemoryRequest, SummarizeResponse } from \"../core/types.js\";\n\n// ── Conversation Routes ─────────────────────────────────────────────────\n\nexport function conversationRoutes(\n  orchestrator: StorageOrchestrator,\n  config: ResolvedConfig\n) {\n  // Summarizer is only available if extraction config is present\n  const summarizer = config.extraction\n    ? new ConversationSummarizer({\n        apiKey: config.extraction.apiKey,\n        baseUrl: config.extraction.baseUrl,\n        model: config.extraction.model,\n      })\n    : null;\n\n  return new Elysia({ prefix: \"/api/conversations\" })\n    // POST /api/conversations/log — Append conversation entry\n    .post(\n      \"/log\",\n      ({ body, set }) => {\n        try {\n          orchestrator.sqlite.appendConversationLog(body as ConversationLogEntry);\n          set.status = 201;\n          return { ok: true };\n        } catch (error) {\n          set.status = 500;\n          return {\n            error: \"Failed to append conversation log\",\n            details: error instanceof Error ? error.message : String(error),\n          };\n        }\n      },\n      {\n        body: t.Object({\n          agent_id: t.String(),\n          session_id: t.String(),\n          user_id: t.String(),\n          channel: t.String(),\n          role: t.Union([\n            t.Literal(\"user\"),\n            t.Literal(\"assistant\"),\n            t.Literal(\"system\"),\n          ]),\n          content: t.String(),\n          timestamp: t.String(),\n        }),\n      }\n    )\n\n    // POST /api/conversations/summarize — Summarize a session\n    .post(\n      \"/summarize\",\n      async ({ body, set }) => {\n        if (!summarizer) {\n          set.status = 501;\n          return { error: \"Summarization not available — extraction config required\" };\n        }\n\n        try {\n          const { agent_id, session_id, user_id, channel, messages } = body;\n\n          const summary = await summarizer.summarize(messages);\n          if (!summary) {\n            set.status = 422;\n            return { error: \"Failed to generate summary\" };\n          }\n\n          const memoryReq: CreateMemoryRequest = {\n            agent_id,\n            scope: \"session\",\n            subject_id: user_id,\n            content: summary,\n            tags: [\"conversation_summary\", channel, `session:${session_id}`],\n            source: \"conversation_summary\",\n            created_by: agent_id,\n            extract_entities: true,\n          };\n\n          const result = await orchestrator.createMemory(memoryReq);\n\n          const response: SummarizeResponse = {\n            memory_id: result.id,\n            summary,\n            entities_extracted: result.entities,\n            relationships_created: 0,\n          };\n\n          set.status = 201;\n          return response;\n        } catch (error) {\n          set.status = 500;\n          return {\n            error: \"Summarization failed\",\n            details: error instanceof Error ? error.message : String(error),\n          };\n        }\n      },\n      {\n        body: t.Object({\n          agent_id: t.String(),\n          session_id: t.String(),\n          user_id: t.String(),\n          channel: t.String(),\n          messages: t.Array(\n            t.Object({\n              role: t.Union([\n                t.Literal(\"user\"),\n                t.Literal(\"assistant\"),\n                t.Literal(\"system\"),\n              ]),\n              content: t.String(),\n              timestamp: t.String(),\n            })\n          ),\n          reason: t.Optional(t.String()),\n        }),\n      }\n    );\n}\n","import { Elysia, t } from \"elysia\";\nimport type { StorageOrchestrator } from \"../storage/orchestrator.js\";\n\n// ── Entity Routes ───────────────────────────────────────────────────────\n\nexport function entityRoutes(orchestrator: StorageOrchestrator) {\n  return new Elysia({ prefix: \"/api/entities\" })\n    // GET /api/entities/:type — List entities by type\n    .get(\"/:type\", async ({ params, query, set }) => {\n      if (!orchestrator.age) {\n        set.status = 501;\n        return { error: \"Graph layer not available — requires Full tier\" };\n      }\n\n      try {\n        const entities = await orchestrator.age.listEntities(\n          params.type,\n          query.agent_id as string | undefined,\n          query.limit ? parseInt(String(query.limit), 10) : 50\n        );\n        return { entities, count: entities.length };\n      } catch (error) {\n        set.status = 500;\n        return {\n          error: \"Failed to list entities\",\n          details: error instanceof Error ? error.message : String(error),\n        };\n      }\n    })\n\n    // GET /api/entities/:type/:id — Get entity with relationships\n    .get(\"/:type/:id\", async ({ params, set }) => {\n      if (!orchestrator.age) {\n        set.status = 501;\n        return { error: \"Graph layer not available — requires Full tier\" };\n      }\n\n      try {\n        const result = await orchestrator.age.getEntityWithRelationships(\n          params.type,\n          params.id\n        );\n        if (!result.entity) {\n          set.status = 404;\n          return { error: \"Entity not found\" };\n        }\n        return result;\n      } catch (error) {\n        set.status = 500;\n        return {\n          error: \"Failed to get entity\",\n          details: error instanceof Error ? error.message : String(error),\n        };\n      }\n    })\n\n    // GET /api/entities/:type/:id/related — Get related entities\n    .get(\"/:type/:id/related\", async ({ params, query, set }) => {\n      if (!orchestrator.age) {\n        set.status = 501;\n        return { error: \"Graph layer not available — requires Full tier\" };\n      }\n\n      try {\n        const depth = query.depth ? parseInt(String(query.depth), 10) : 2;\n        const related = await orchestrator.age.getRelatedEntities(\n          params.id,\n          depth\n        );\n        return { related, count: related.length };\n      } catch (error) {\n        set.status = 500;\n        return {\n          error: \"Failed to get related entities\",\n          details: error instanceof Error ? error.message : String(error),\n        };\n      }\n    })\n\n    // POST /api/entities/extract — Manually trigger entity extraction\n    .post(\n      \"/extract\",\n      async ({ body, set }) => {\n        if (!orchestrator.entityExtractor) {\n          set.status = 501;\n          return { error: \"Entity extraction not available — requires extraction config\" };\n        }\n\n        try {\n          const result = await orchestrator.entityExtractor.extract(body.text);\n          return result;\n        } catch (error) {\n          set.status = 500;\n          return {\n            error: \"Entity extraction failed\",\n            details: error instanceof Error ? error.message : String(error),\n          };\n        }\n      },\n      {\n        body: t.Object({\n          text: t.String(),\n        }),\n      }\n    );\n}\n","import { Elysia, t } from \"elysia\";\nimport fs from \"node:fs\";\nimport path from \"node:path\";\nimport type { StorageOrchestrator } from \"../storage/orchestrator.js\";\nimport type { CreateMemoryRequest, MigrateMarkdownRequest } from \"../core/types.js\";\n\n// ── Admin Routes ────────────────────────────────────────────────────────\n\nexport function adminRoutes(orchestrator: StorageOrchestrator) {\n  return new Elysia()\n    // GET /api/health — Health check\n    .get(\"/api/health\", async () => {\n      return await orchestrator.healthCheck();\n    })\n\n    // POST /api/sync/retry — Retry failed L2/L3 syncs\n    .post(\"/api/sync/retry\", async ({ set }) => {\n      try {\n        const result = await orchestrator.retrySyncQueue();\n        return result;\n      } catch (error) {\n        set.status = 500;\n        return {\n          error: \"Sync retry failed\",\n          details: error instanceof Error ? error.message : String(error),\n        };\n      }\n    })\n\n    // GET /api/sync/queue — View pending sync queue\n    .get(\"/api/sync/queue\", () => {\n      const items = orchestrator.sqlite.getSyncQueue(100);\n      return { items, count: items.length };\n    })\n\n    // POST /api/admin/migrate-markdown — Migrate markdown files\n    .post(\n      \"/api/admin/migrate-markdown\",\n      async ({ body, set }) => {\n        try {\n          const results = await migrateMarkdownFiles(orchestrator, body);\n          return results;\n        } catch (error) {\n          set.status = 500;\n          return {\n            error: \"Migration failed\",\n            details: error instanceof Error ? error.message : String(error),\n          };\n        }\n      },\n      {\n        body: t.Object({\n          markdown_paths: t.Array(t.String()),\n          agent_id: t.String(),\n          dry_run: t.Optional(t.Boolean()),\n        }),\n      }\n    )\n\n    // POST /api/admin/daily-digest — Trigger daily digest\n    .post(\"/api/admin/daily-digest\", async ({ set }) => {\n      set.status = 501;\n      return { error: \"Not yet implemented\" };\n    });\n}\n\n// ── Markdown Migration ──────────────────────────────────────────────────\n\nasync function migrateMarkdownFiles(\n  orchestrator: StorageOrchestrator,\n  request: MigrateMarkdownRequest\n): Promise<{\n  migrated: number;\n  skipped: number;\n  errors: string[];\n  memories: Array<{ id: string; content_preview: string }>;\n}> {\n  const { markdown_paths, agent_id, dry_run } = request;\n  let migrated = 0;\n  let skipped = 0;\n  const errors: string[] = [];\n  const memories: Array<{ id: string; content_preview: string }> = [];\n\n  for (const filePath of markdown_paths) {\n    try {\n      if (!fs.existsSync(filePath)) {\n        errors.push(`File not found: ${filePath}`);\n        skipped++;\n        continue;\n      }\n\n      const content = fs.readFileSync(filePath, \"utf-8\");\n      const fileName = path.basename(filePath, \".md\");\n      const sections = parseMarkdownSections(content);\n\n      for (const section of sections) {\n        if (section.content.trim().length < 10) {\n          skipped++;\n          continue;\n        }\n\n        if (dry_run) {\n          memories.push({\n            id: \"(dry-run)\",\n            content_preview: section.content.slice(0, 100),\n          });\n          migrated++;\n          continue;\n        }\n\n        const scope = inferScope(section.heading, fileName);\n        const source = inferSource(fileName);\n        const tags = inferTags(section.heading, fileName);\n\n        const req: CreateMemoryRequest = {\n          agent_id,\n          scope,\n          subject_id: null,\n          content: section.content.trim(),\n          tags,\n          source: source || \"migration\",\n          created_by: \"migration\",\n          extract_entities: true,\n        };\n\n        try {\n          const result = await orchestrator.createMemory(req);\n          memories.push({\n            id: result.id,\n            content_preview: section.content.slice(0, 100),\n          });\n          migrated++;\n        } catch (error) {\n          errors.push(\n            `Failed to migrate section \"${section.heading}\": ${error instanceof Error ? error.message : String(error)}`\n          );\n        }\n      }\n    } catch (error) {\n      errors.push(\n        `Failed to process ${filePath}: ${error instanceof Error ? error.message : String(error)}`\n      );\n    }\n  }\n\n  return { migrated, skipped, errors, memories };\n}\n\n// ── Markdown Parsing Helpers ────────────────────────────────────────────\n\ninterface MarkdownSection {\n  heading: string;\n  content: string;\n  level: number;\n}\n\nfunction parseMarkdownSections(markdown: string): MarkdownSection[] {\n  const lines = markdown.split(\"\\n\");\n  const sections: MarkdownSection[] = [];\n  let currentHeading = \"root\";\n  let currentLevel = 0;\n  let currentContent: string[] = [];\n\n  for (const line of lines) {\n    const headingMatch = line.match(/^(#{1,3})\\s+(.+)/);\n    if (headingMatch) {\n      if (currentContent.length > 0) {\n        sections.push({\n          heading: currentHeading,\n          content: currentContent.join(\"\\n\").trim(),\n          level: currentLevel,\n        });\n      }\n      currentHeading = headingMatch[2].trim();\n      currentLevel = headingMatch[1].length;\n      currentContent = [];\n    } else {\n      currentContent.push(line);\n    }\n  }\n\n  if (currentContent.length > 0) {\n    sections.push({\n      heading: currentHeading,\n      content: currentContent.join(\"\\n\").trim(),\n      level: currentLevel,\n    });\n  }\n\n  return sections;\n}\n\nfunction inferScope(heading: string, fileName: string): CreateMemoryRequest[\"scope\"] {\n  const h = heading.toLowerCase();\n  const f = fileName.toLowerCase();\n\n  if (h.includes(\"about\") || h.includes(\"personal\")) return \"user\";\n  if (h.includes(\"project\")) return \"project\";\n  if (h.includes(\"agent\")) return \"agent\";\n  if (h.includes(\"session\") || f.match(/^\\d{4}-\\d{2}-\\d{2}/)) return \"session\";\n  return \"global\";\n}\n\nfunction inferSource(fileName: string): CreateMemoryRequest[\"source\"] | null {\n  if (fileName.match(/^\\d{4}-\\d{2}-\\d{2}/)) return \"daily_digest\";\n  return \"migration\";\n}\n\nfunction inferTags(heading: string, fileName: string): string[] {\n  const tags: string[] = [\"migration\"];\n  if (fileName.match(/^\\d{4}-\\d{2}-\\d{2}/)) {\n    tags.push(\"daily\", fileName);\n  }\n  if (heading !== \"root\") {\n    tags.push(heading.toLowerCase().replace(/[^a-z0-9]+/g, \"-\"));\n  }\n  return tags;\n}\n"],"mappings":"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","names":["Elysia","Elysia","t","t","Elysia","Elysia","t","Elysia","t","Elysia","t","Elysia","t","Elysia","path","msg"]}